class Solution {
    private int forbiddenSecond(String s, char x, char y, char ch) {
        int n = s.length(), c1 = 0, c2 = 0, ans = 0;
        HashMap<Integer, Integer> hm = new HashMap<>();
        hm.put(0, -1);
        for (int i = 0; i < n; i++) {
            if(s.charAt(i) == ch) {
                hm = new HashMap<>();
                hm.put(0, i);
                c1 = 0; c2 = 0;
            }
            if(s.charAt(i) == x) {
                c1++;
            }
            if (s.charAt(i) == y) {
                c2++;
            }
            int diff = c1 - c2;
            if(hm.containsKey(diff)) {
                ans = Math.max(ans, i - hm.get(diff));
            } else {
                hm.put(diff, i);
            }
        }
        return ans;
    }
    public int longestBalanced(String s) {
        //first
        int i = 1, cnt = 1, first = 1, maxAns = 0, n = s.length();
        while(i < n) {
            if( i < n && s.charAt(i) == s.charAt(i-1)) {
                cnt++;
            }
            else {
                cnt = 1;
            }
            first = Math.max(cnt, first);
            i++;
        }
        maxAns = Math.max(maxAns, first);
        //second
        maxAns = Math.max(maxAns, forbiddenSecond(s, 'a', 'b', 'c'));
        maxAns = Math.max(maxAns, forbiddenSecond(s,'a', 'c', 'b'));
        maxAns = Math.max(maxAns, forbiddenSecond(s, 'b', 'c', 'a'));

        //third 
        maxAns = Math.max(maxAns, combineThird(s, n));
        return maxAns;
    }
    private int combineThird(String s, int n) {
        int a = 0, b = 0, c = 0, ans = 0;
        HashMap<String, Integer> hm = new HashMap<>();
        hm.put("0#0", -1);
        for(int i = 0; i < n; i++) {
            if(s.charAt(i) == 'a') a++;
            if(s.charAt(i) == 'b') b++;
            if(s.charAt(i) == 'c') c++;
            String currKey = (a-b)+"#"+(b-c);
            if(hm.containsKey(currKey)) {
                ans = Math.max(ans, i - hm.get(currKey));
            } else{
                hm.put(currKey, i);
            }
        }
        return ans;
    }
}

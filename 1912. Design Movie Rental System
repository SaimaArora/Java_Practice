class MovieRentingSystem {

    Map<Integer,TreeSet<int[]>> unrented;
    TreeSet<int[]> rented;
    Map<Integer,Map<Integer,Integer>> price;
    public MovieRentingSystem(int n, int[][] entries) {
        unrented=new HashMap<>();
        rented=new TreeSet<>((a,b)->{
            if(a[1]!=b[1]) return a[1]-b[1];
            else if(a[2]!=b[2]) return a[2]-b[2];
            return a[0]-b[0];
        });
        price=new HashMap<>();
        for(int[] movie: entries){
            int s=movie[0];
            int m=movie[1];
            int p=movie[2];
            price.computeIfAbsent(s,k-> new HashMap<>()).put(m,p);
            unrented.computeIfAbsent(m,k-> new TreeSet<>((a,b)->{
                if(a[0]!=b[0]) return a[0]-b[0];
                return a[1]-b[1];
            })).add(new int[]{p,s});
        }
    }
    
    public List<Integer> search(int movie) {
        TreeSet<int[]> top5 = unrented.getOrDefault(movie, new TreeSet<>());
        List<Integer> result=new ArrayList<>();
        int count=0;
        for(int[] shops:top5){
            if(count>=5) break;
            result.add(shops[1]);
            count++;
        }
        return result;
    }
    
    public void rent(int shop, int movie) {
        int pri=price.get(shop).get(movie);
        unrented.get(movie).remove(new int[]{pri,shop});
        rented.add(new int[]{movie,pri,shop});
    }
    
    public void drop(int shop, int movie) {
        int pri=price.get(shop).get(movie);
        rented.remove(new int[]{movie,pri,shop});
        unrented.computeIfAbsent(movie,k-> new TreeSet<>()).add(new int[]{pri,shop});
    }
    
    public List<List<Integer>> report() {
        List<List<Integer>> answer=new ArrayList<>();
        int count=0;
        for(int[] rent: rented){
            if(count>=5) break;
            count++;
            answer.add(Arrays.asList(rent[2], rent[0]));
        }
        return answer;
    }
}

/**
 * Your MovieRentingSystem object will be instantiated and called as such:
 * MovieRentingSystem obj = new MovieRentingSystem(n, entries);
 * List<Integer> param_1 = obj.search(movie);
 * obj.rent(shop,movie);
 * obj.drop(shop,movie);
 * List<List<Integer>> param_4 = obj.report();
 */
